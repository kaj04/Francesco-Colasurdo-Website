<nav
    class="sticky top-0 z-30 w-full bg-paper/90 backdrop-blur-md border-b border-stone-200/50 transition-all duration-300 relative overflow-hidden h-24 group">

    <div class="absolute inset-0 w-full h-full z-0 pointer-events-none select-none overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-b from-paper/20 to-paper z-10"></div>
        <img src="{{ .Site.Params.navbar_bg_image }}" alt="Stadium Crowd"
            class="w-full h-full object-cover object-center grayscale blur-[2px] opacity-[0.15] mix-blend-multiply transition-all duration-700 ease-in-out"
            style="mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,0.5) 80%, rgba(0,0,0,0) 100%); -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 0%, rgba(0,0,0,0.5) 80%, rgba(0,0,0,0) 100%);" />
    </div>

    <div class="max-w-6xl mx-auto px-6 h-full flex items-center justify-between relative z-20">
        <!-- Logo -->
        <a href="{{ "" | absURL }}" class="cursor-pointer group/logo">
            <span
                class="font-serif text-3xl font-bold text-ink group-hover/logo:text-primary transition-colors duration-300">FC.</span>
        </a>

        <!-- Menu Items -->
        <div class="hidden md:flex gap-10">
            {{ $current := . }}
            {{ range .Site.Menus.main }}
            {{ $isActive := or ($current.IsMenuCurrent "main" .) ($current.HasMenuCurrent "main" .) }}
            <a href="{{ .URL | relURL }}"
                class="text-lg font-serif tracking-wide transition-all duration-300 relative py-1 hover:text-ink cursor-pointer {{ if $isActive }}text-primary{{ else }}text-stone-500{{ end }}">
                {{ .Name }}
                <span
                    class="absolute bottom-0 left-0 w-full h-[2px] bg-primary transform origin-left transition-transform duration-300 {{ if $isActive }}scale-x-100{{ else }}scale-x-0{{ end }}"></span>
            </a>
            {{ end }}
        </div>

        <!-- Mobile placeholder -->
        <div class="md:hidden relative" id="mobile-menu-container">
            <button id="mobile-menu-toggle"
                class="text-stone-500 font-serif italic text-lg focus:outline-none hover:text-ink transition-colors px-2 py-1">
                [Menu]
            </button>
        
            <div id="mobile-dropdown"
                class="absolute right-0 top-12 mt-2 w-56 bg-paper border border-stone-200 rounded-lg shadow-2xl opacity-0 invisible transform -translate-y-2 transition-all duration-200 flex flex-col overflow-hidden max-h-[80vh] overflow-y-auto ring-1 ring-black/5">
        
                {{ range .Site.Menus.main }}
                {{ $isActive := or ($current.IsMenuCurrent "main" .) ($current.HasMenuCurrent "main" .) }}
                <a href="{{ .URL | relURL }}"
                    class="block px-6 py-4 text-lg font-serif hover:bg-stone-100 transition-colors border-b border-stone-100 last:border-0 {{ if $isActive }}text-primary font-bold italic{{ else }}text-ink{{ end }}">
                    {{ .Name }}
                </a>
                {{ end }}
            </div>
        </div>
        </div>
        
        <script>
            const btn = document.getElementById('mobile-menu-toggle');
            const dropdown = document.getElementById('mobile-dropdown');
            const container = document.getElementById('mobile-menu-container');
            let isOpen = false;

            function toggleMenu() {
                isOpen = !isOpen;
                if (isOpen) {
                    // APERTURA
                    dropdown.classList.remove('opacity-0', 'invisible', '-translate-y-2');
                    dropdown.classList.add('opacity-100', 'visible', 'translate-y-0');
                    btn.textContent = "[Close]";
                    btn.classList.add('text-ink', 'font-bold');
                } else {
                    // CHIUSURA
                    dropdown.classList.remove('opacity-100', 'visible', 'translate-y-0');
                    dropdown.classList.add('opacity-0', 'invisible', '-translate-y-2');
                    btn.textContent = "[Menu]";
                    btn.classList.remove('text-ink', 'font-bold');
                }
            }

            // Click sul bottone
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleMenu();
            });

            // Chiudi se clicchi fuori
            document.addEventListener('click', (e) => {
                if (isOpen && !container.contains(e.target)) {
                    toggleMenu();
                }
            });

            // Chiudi se scrolli la pagina (opzionale, per pulizia)
            window.addEventListener('scroll', () => {
                if (isOpen) toggleMenu();
            }, { passive: true });
        </script>
        </nav>